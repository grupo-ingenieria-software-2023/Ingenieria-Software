<!DOCTYPE html>
<html lang="es">
<head>
    {% load static %}
    {% include "componentes/default_head.html" %}
    <link rel="stylesheet" href="{% static 'styles/caja.css' %}">
</head>
<body onload="inicializar_caja()">
    {% include "componentes/header.html" %}

    <script>
        function mostrar_tab(tab) {
            elems = document.getElementsByClassName("tab");
            for (elem of elems) elem.hidden = true;
            document.getElementById(tab).hidden = false;
        }
    </script>

    

    <main class="contenedor">
        <nav class="nav__menu">
            <style>
                nav p:hover { color: goldenrod; }
            </style>
            <p class="nav__menu__enlace" onclick="mostrar_tab('omn')">Pizzas Omnivoras</p>
            <p class="nav__menu__enlace" onclick="mostrar_tab('vgt')">Pizzas Vegetarianas</p>
            <p class="nav__menu__enlace" onclick="mostrar_tab('vgn')">Pizzas Veganas</p>
            <p class="nav__menu__enlace" onclick="mostrar_tab('aco')">Acompañamientos</p>
        </nav>

        <form>
            {% include "componentes/lista_pizzas.html" with productos=omnivoras titulo="Pizzas Omnívoras" precios_mult=True es_default=True id="omn" %}
            {% include "componentes/lista_pizzas.html" with productos=vegetarianas titulo="Pizzas Vegetarianas" precios_mult=True id="vgt" %}
            {% include "componentes/lista_pizzas.html" with productos=veganas titulo="Pizzas Veganas" precios_mult=True id="vgn" %}
            {% include "componentes/lista_pizzas.html" with productos=acompanamientos titulo="Acompañamientos" precios_mult=False id="aco" %}

            <div class="contenedor separador">
            </div>

            <script>
                // pedidos, según tamaño y por ende precio
                let medianas = new Object();
                let familiares = new Object();
                let acompanamientos = new Object();

                let datos = new Object();
                function inicializar_caja() {
                    temp_datos = JSON.parse('{{ datos|safe }}');
                    for (producto of temp_datos) {
                        datos[producto["pk"].toString()] = producto.fields;
                    }
                }

                function modificar_pedido(id, tamano, agregar = true) {
                    id = id.toString();
                    let objeto_pedido = null;
                    if (tamano == "mediana") objeto_pedido = medianas;
                    else if (tamano == "familiar") objeto_pedido = medianas;
                    else objeto_pedido = acompanamientos;

                    let boton = document.getElementById(`boton-${id}`);

                    if (agregar) {
                        if (objeto_pedido[id] == undefined) objeto_pedido[id] = 1;
                        else objeto_pedido[id] += 1;
                    }
                    else {
                        if (objeto_pedido[id] != undefined) {
                            objeto_pedido[id] -= 1;
                            if (objeto_pedido[id] <= 0) delete objeto_pedido[id];
                        }
                    }

                    boton.value = objeto_pedido[id] ?? 0;

                    render_caja();
                }

                function render_caja() {
                    console.log("Rendereando:");
                    console.log(medianas);
                    console.log(familiares);
                    console.log(acompanamientos);
                }


            </script>
            <div class="contenedor caja">
                caja
            </div>
        </form>
    </main>

    {% include "componentes/footer.html" %}    
</body>
</html>